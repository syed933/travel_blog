import React, { Component } from 'react';
import MiniSearch from 'minisearch';
import Link from 'next/link';

class SearchBar extends Component {
    constructor(props) {
        super(props);

       

        this.state = {
            keyword: "",
            results: []
        };
    }

    onInput(ev) {
        const search = ev.target.value.trim();

        this.setState({ keyword: search});

        const miniSearch = new MiniSearch({
            fields: ['title'],
            storeFields: ['title', 'slug']
        });

        miniSearch.addAll(this.props.posts);
        
        const results = miniSearch.search(search, {fuzzy: 0.2});

        this.setState({results: results});
    }

    render() {
        return (
            <div className='bg-white bg-opacity-60 py-8 px-4 mb-8 rounded align-center'>
                <div className="icon flex justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                        width="38" height="38"
                        viewBox="0 0 512 512">
                        <path d="M 209.41992 43.824219 C 167.06892 43.824344 124.71706 59.943594 92.476562 92.183594 C 61.239563 123.42059 44.037109 164.95195 44.037109 209.12695 C 44.037109 253.30195 61.240562 294.83236 92.476562 326.06836 C 119.28456 352.87536 154.77883 369.76881 192.42383 373.63281 C 226.82583 377.16681 261.69309 369.76242 291.49609 352.73242 L 394.39844 455.63281 C 402.79944 464.03381 413.83414 468.23438 424.86914 468.23438 C 435.90414 468.23437 446.93884 464.03381 455.33984 455.63281 C 472.14184 438.83081 472.14184 411.49245 455.33984 394.68945 L 352.59766 291.94727 C 369.85866 262.10427 377.42575 227.12945 373.96875 192.56445 C 370.18675 154.75145 353.27933 119.10159 326.36133 92.183594 C 294.12083 59.943094 251.77092 43.824094 209.41992 43.824219 z M 209.41992 63.814453 C 246.64917 63.814328 283.8787 77.983672 312.2207 106.32617 C 360.3937 154.49917 368.5275 230.91163 331.5625 288.01562 C 328.9995 291.97462 329.55172 297.18453 332.88672 300.51953 L 441.19727 408.83203 C 450.20227 417.83603 450.20127 432.48623 441.19727 441.49023 C 432.19227 450.49423 417.54206 450.49223 408.53906 441.49023 L 300.09961 333.05078 C 298.16961 331.11978 295.60839 330.12109 293.02539 330.12109 C 291.16639 330.12109 289.29562 330.63827 287.64062 331.69727 C 230.65163 368.14627 154.52214 359.83173 106.61914 311.92773 C 79.160141 284.46973 64.037109 247.95995 64.037109 209.12695 C 64.037109 170.29495 79.160141 133.78517 106.61914 106.32617 C 134.96114 77.984172 172.19067 63.814578 209.41992 63.814453 z M 209.41992 100.36523 C 181.5553 100.36523 153.68956 110.97255 132.47656 132.18555 C 90.049562 174.61255 90.049563 243.64331 132.47656 286.07031 C 150.11456 303.70831 173.47023 314.82223 198.24023 317.36523 C 201.93023 317.74323 205.62736 317.93164 209.31836 317.93164 C 230.04036 317.93164 250.52356 312.01842 267.97656 300.85742 C 274.59856 296.62242 280.78333 291.64731 286.36133 286.07031 C 291.79533 280.63531 296.66312 274.61855 300.82812 268.18555 C 314.15212 247.60255 320.13855 222.75842 317.68555 198.23242 C 315.19755 173.35142 304.07233 149.89655 286.36133 132.18555 C 265.14783 110.97255 237.28455 100.36523 209.41992 100.36523 z M 209.41992 120.35547 C 232.16392 120.35547 254.9067 129.01217 272.2207 146.32617 C 301.6487 175.75517 306.61906 222.43245 284.03906 257.31445 C 280.63806 262.56945 276.6597 267.48673 272.2207 271.92773 C 267.6617 276.48473 262.60817 280.54786 257.20117 284.00586 C 222.38917 306.27186 175.88314 301.19173 146.61914 271.92773 C 111.99014 237.29973 111.99014 180.95417 146.61914 146.32617 C 163.93314 129.01217 186.67692 120.35547 209.41992 120.35547 z">
                        </path>
                    </svg>
                    <div className='pl-2 rounded'>
                        <div className='rounded'>
                            <input onInput={ this.onInput.bind(this) } className='py-2 px-20 rounded' type="text" placeholder='Search a hike here'/>
                        </div>
                        <div className="bg-white rounded flex flex-col items-center">
                            { this.state.results.map((post, i) => (

                            <p className='p-2' key={i}> 
                                <Link href={`/post/${post.slug}`} key={i} className='text-md'>
                                    {post.title}
                                </Link>
                             </p>
                            )
                            )}
                        </div>
                    </div>  
                </div>
            </div>
        )
    }
}

export default SearchBar
